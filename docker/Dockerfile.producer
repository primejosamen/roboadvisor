# syntax=docker/dockerfile:1.4
FROM python:3.11-slim

ARG PRODUCER_SCRIPT
ENV PYTHONDONTWRITEBYTECODE=1 PIP_NO_CACHE_DIR=1

WORKDIR /app
COPY services/${PRODUCER_SCRIPT} /app/producer.py
COPY services/ /app/

# ------------------------------------------------------------------
#  System build tools – needed to compile wheels such as confluent-kafka
# ------------------------------------------------------------------
RUN apt-get update && \
    apt-get install -y --no-install-recommends gcc g++ && \
    rm -rf /var/lib/apt/lists/*

# ------------------------------------------------------------------
#  Python libraries common to the Gen-AI “front” producers
# ------------------------------------------------------------------
RUN pip install --no-cache-dir \
    requests \
    confluent-kafka \
    PyPDF2 \
    langchain \
    langchain_openai \
    langchain_elasticsearch \
    langchain_experimental \
    langchain-text-splitters \
    fastavro \
    elasticsearch \
    flask \
    flask_socketio \
    flask_cors \
    openai \
    pyopenssl \
    avro-python3 \
    jproperties \
    cachetools \
    authlib \
    pymongo \
    websocket-client \
    pandas \
    pypdf \
    azure-ai-documentintelligence \
    duckdb \
    pyarrow \
    confluent_kafka

ENTRYPOINT ["python", "/app/producer.py"]
